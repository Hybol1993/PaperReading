Mars code 阅读报告
============

<center>毛海宇 2015310607 </center>

##本文介绍##
Mars code是介绍JPL飞行软件团队为提高软件的可靠性来采取的一些预防措施。该文开始介绍了航天器的运行过程和组成部分，表明航天嵌入式软件的独一无二：只有航天任务一个目标客户。简要说明了软件的可靠性对于航天器的重要性。并提出了三条重要见解：
>1. 星际飞船控制软件的设计必须具有高标准的**可靠性**。任何细小的错误皆能造成任务的失败。
>2. 在硬件和软件上**均匀**采取了特别的措施，确保航天器可靠运行，且系统能在数百万英里外调试和修复。
>3. 形式化方法有助于验证复杂软件子系统可能存在的**争用**情形和死锁；新型的模型检查技术可以实现这一过程的自动化。

本文不介绍良好的软件架构的定义，也不介绍良好的软件开发过程，而着重介绍飞行软件团队在开发MSL任务软件过程中采取的预防措施。将内容归为3方面：

> 1. **代码编写标准**有稀疏，基于风险和受自动化合规性检查工具支持的特点；
> 2. 高效的对大量代码进行全面清理的**代码审核流程**；
> 3. 可以形式化验证任务关键型代码中是否存在与并发相关的缺陷的**逻辑模型检查工具**。

下面将着重对这3方面进行介绍。
##MSL开发过程预防措施##
####1.基于风险的代码编写规则####
 使用影响航天任务的大多数异常问题记录对每种软件的异常的根本原因进行分类，制作出一份主要问题领域清单，包括：
>1.不规范使用多任务处理器的造成的错误
>2.动态内存分配技术的使用
>3.标准故障保护技术也有意外的副作用

这个代码编写标准只包含风险相关的规则，没有风格相关规则。加入JPL代码编写新标准的规则符合两大准则：
>1.规则必须与异常分类中的风险有直接关联
>2.对代码编写规则的合规性必须能够通过基于工具的检查方法进行验证

制定的代码编写标准认可不同的合规级别（从LOC-1到LOC-6，低到高），适用于不同类型的软件。

**LOC-1**　两条规则：
>1.所有代码不能依赖超越该语言定义本身的特定编译器扩展
>2.所有代码可通过编译器和良好静态源码分析器的考验，不会触发警告

**LOC-2**　添加规则，确保嵌入式系统上下文中的可预测执行：
>所有循环在可执行迭代数量上必须具有能够静态验证的上限

**LOC-3**：
>软件每个模块的断言密度至少要达到2%
>>与过去的区别：所有断言在整个飞行期间都保持启用状态，断言的失败与故障保护系统绑定，默认将航天器至于预定义的安全状态，在仔细诊断失败原因后再恢复。

**LOC-４**　所有任务关键型代码的级别：
>限制对Ｃ语言预处理程序，函数指针，指针间接寻址的使用

**LOC-5  LOC-6**　安全关键型软件和载人软件必须符合的级别：
>MISRA C代码的编写准则中的所有规则

与Coverity, Codesonar和Semmle等静态源码分析工具供应商合作，开发自动合规性检查器。对飞行软件开发人员也有认证计划。

####2.基于工具的代码审核####
同行审核：代码少，非规则遵从性和编写错误的代码，可以用同行审核。
静态源码分析工具：检查规则遵从性和编写错误。
用四个分析器Coverity, Codesonar，Semmle和Uno，尽可能识别所有缺陷。

scrub（本文开发）：整合静态分析器和其他各种后台检查器的输出，同时提供人工同行代码审核意见。模块所有者需要对每一次报告做回复（无论人工填写的还是分析工具自动生成的），回复结果分三种：同意，反对，讨论。

绝大多数意见和工具报告都能产生直接达成一致的代码更改。


####3.逻辑模型检查####
**Spin：逻辑模型检查器**
专门验证具有异步线程执行的分布式系统软件。内部验证算法以Vardi和Wolper的自动机理论验证方法为基础。

**验证代码步骤：**
>1.定义一个简单的测试驱动程序（根据调用原程序），设置好陷阱，用不同的线程来进行测试。
>2.用一个小的配置文件来标明代码中客户感兴趣的部分，通过它可以提取代码中的相关部分并将他们放入之后要分析的可执行系统中，来定义我们要验证的系统的上下文。
>3.用模型提取工具Modex和模型检查器Spin通过一条命令来执行算法的验证。

##总结##
对于航天工程，不仅需要软件开发的成功，还需要硬件组件的冗余配合。冗余对软件的可靠性作用不是很明显。
软件的冗余：强调代码中多使用断言；用两个版本的代码来保证着落过程的安全。

